<?php
	
	session_start();
	set_time_limit(-1);
	ini_set('memory_limit','128M');
	include ("../funciones.php");

    include_once ("../../clases/MySQL.php");	
    include_once("../../comunes/objConexion.php");
    include_once("../include/funciones_php.php");
     	
    $c=0;

     
	foreach($_POST as $nombreCampo => $valor)
	{
		$$nombreCampo = $valor;
	}


	/*foreach($_POST as $nombre_campo => $valor){
	$asignacion = "\$" . $nombre_campo . "='" . $valor . "';";
	eval($asignacion);
	}*/


	switch($caso)
	{
            
		case 'LISTA_PERSONA__BuscarListado':				
			$sql = "select * from mastpersonas where Ndocumento like '%$CadenaBuscarpersona%' and TipoPersona='N'"; 				
			$resp = $objConexion->consultar($sql,'matriz');
		break;

		case 'CargarSelectEventos':				
			$sql = "select co_id_evento, tx_nombre_evento from ev_evento_capacitacion;"; 				
			$resp = $objConexion->consultar($sql,'matriz');
		break;



		case 'LISTA_PARTICIPANTES__BuscarListado':				
			$sql = "select * from mastpersonas where Ndocumento like '%$CadenaBuscarparticipantes%' and TipoPersona='N' and CodPersona<>'".$ponente."'"; 				
			$resp = $objConexion->consultar($sql,'matriz');
		break;



		case 'cargarEventos':		
			//$sql = "select * from ev_evento_capacitacion where tx_nombre_evento LIKE '%$CadenaBuscar%' and eliminado=false"; 

			$sql = "select A.co_id_evento,A.hh_fecha1,A.hh_fecha2,A.tx_tema,A.tx_lugar,A.co_id,A.tx_nombre_evento,A.tx_descripcion_evento,A.hh_hora1,A.hh_hora2,A.bo_certificado, A.nu_actividad,A.eliminado,B.CodPersona,B.bo_culmino_evento,B.bo_recibio_certificado,B.bo_ponente,B.tx_nu_certificado, C.CodPersona, C.NomCompleto,C.Ndocumento from ev_evento_capacitacion as A, ev_persona_evento as B, mastpersonas as C where A.co_id_evento=B.co_id_evento and B.CodPersona=C.CodPersona and A.tx_nombre_evento LIKE '%$CadenaBuscar%' and A.eliminado=false and bo_ponente=1";

			$resp = $objConexion->consultar($sql,'matriz');	
		break;



		case 'cargarParticipantesEvento':
			//$sql = "select * from ev_persona_evento where bo_ponente=0 and eliminado= false and co_id_evento=1";

			$sql= "select A.co_id_persona_evento, A.CodPersona, A.bo_culmino_evento, A.bo_recibio_certificado, A.bo_ponente, A.tx_nu_certificado, A.co_id_evento, A.eliminado, B.NomCompleto, B.Ndocumento from ev_persona_evento as A, mastpersonas as B  where A.CodPersona=B.CodPersona and A.bo_ponente=0 and A.eliminado=false and A.co_id_evento=".$CodEvento.";";
			$resp = $objConexion->consultar($sql,'matriz');	
		break;


		case 'TiposEventosBuscarListado':
		$sql="SELECT * FROM ev_tipo_capacitacion WHERE (eliminado=false AND (tx_nombre_cap LIKE '%".$CadenaBuscar."%')) OR co_id='CadenaBuscarTE' ORDER BY co_id";
			$resp = $objConexion->consultar($sql,'matriz');
		break;

		case 'EventosExiste':	
		$sql = "select count(*) as num from ev_evento_capacitacion where eliminado=false and tx_nombre_evento like '".$NombreEvento."' and tx_lugar like '".$LugarEvento."' and hh_fecha1='".$FechaInicio."' and hh_hora1='".$hora_inicio.":".$minuto_inicio."-".$turno_inicio."'";    	
			$resp = $objConexion->consultar($sql,'matriz');	
		break;

		

		case 'EventosGuardar':

		if($objConexion->ingresar(array("hh_fecha1,hh_fecha2,tx_tema,tx_lugar,co_id,tx_nombre_evento,tx_descripcion_evento,hh_hora1,hh_hora2,bo_certificado,nu_actividad","'".$fecha_inicio."','".$fecha_culminacion."','".$tema_evento."','".$lugar_evento."','".$tipo_evento."','".$nombre_evento."','".$descripcion_evento."','".$hora_inicio.":".$minuto_inicio."-".$turno_inicio."','".$hora_culmi.":".$minuto_culmi."-".$turno_culmi."','".$certificado."','".$n_actividad."'"),'ev_evento_capacitacion')== true)
		{

			$sql="select MAX(co_id_evento) as maximoevento from ev_evento_capacitacion";
	 		$ultvalor = $objConexion->consultar($sql,'fila');
			$maxevento = $ultvalor['maximoevento'];
		
			$objConexion->ingresar(array("CodPersona,bo_culmino_evento,bo_recibio_certificado, bo_ponente,tx_nu_certificado,co_id_evento","'".$cod_ponente."',1,1,1,'xxxx',".$maxevento.""),'ev_persona_evento');

			


			$ARREGLO_PARTICIPANTES=explode(",",$Arreglo);
			
			for($i=0;$i<$tam_arreglo*6;$i=$i+6)
			{

			$cod_participante=$ARREGLO_PARTICIPANTES[$i];
			$cedula_participante=$ARREGLO_PARTICIPANTES[$i+1];
			$nombre_participante=$ARREGLO_PARTICIPANTES[$i+2];

			$culmino_participante=$ARREGLO_PARTICIPANTES[$i+3];
				if($culmino_participante=='S' || $culmino_participante=='s'){
				$culmino="1";}
				else{
				$culmino="0";}

			$certificado_participante=$ARREGLO_PARTICIPANTES[$i+4];
				if($certificado_participante=='S' || $culmino_participante=='s'){
				$certificado="1";}
				else{
				$certificado="0";}

			$n_certificado_participante=$ARREGLO_PARTICIPANTES[$i+5];

			$objConexion->ingresar(array("CodPersona,bo_culmino_evento,bo_recibio_certificado, bo_ponente,tx_nu_certificado,co_id_evento","'".$cod_participante."','".$culmino."','".$certificado."',0,".$n_certificado_participante.",".$maxevento.""),'ev_persona_evento');
			}
	  			
					$resp=1;
		}
				
			else
			{
					$resp=0;
			}


		break;



		case 'EventosModificar':

		if ($objConexion->modificar(array(
				"hh_fecha1='".$fecha_inicio."',
				hh_fecha2='".$fecha_culminacion."',
				tx_tema='".$tema_evento."',
				tx_lugar='".$lugar_evento."',
				co_id='".$tipo_evento."',
				tx_nombre_evento='".$nombre_evento."',
				tx_descripcion_evento='".$descripcion_evento."',
				hh_hora1='".$hora_inicio.":".$minuto_inicio."-".$turno_inicio."',
				hh_hora2='".$hora_culmi.":".$minuto_culmi."-".$turno_culmi."',
				bo_certificado='".$certificado."',
				nu_actividad='".$n_actividad."'","co_id_evento=".$co_id_evento),'ev_evento_capacitacion') == true)
				{

							
					/*$objConexion->modificar(array(
						"CodPersona='".$cod_ponente."',
						bo_culmino_evento=1,
						bo_recibio_certificado=1,
						bo_ponente=1,
						tx_nu_certificado='xxx',
						co_id_evento=".$co_id_evento."","co_id_evento=".$co_id_evento),'ev_persona_evento');*/


			/*$sql = "update ev_persona_evento set ".$registros[0]." where ".$registros[1];

update ev_persona_evento set CodPersona='000013', bo_culmino_evento=1, bo_recibio_certificado=1, bo_ponente=1, tx_nu_certificado='xxx', eliminado=false where co_id_evento=4 and bo_ponente=1;*/
					

					

					$ARREGLO_PARTICIPANTES=explode(",",$Arreglo);

					if($objConexion->eliminar("co_id_evento=".$co_id_evento,"ev_persona_evento") == true)
					{

					$objConexion->ingresar(array("CodPersona,bo_culmino_evento,bo_recibio_certificado, bo_ponente,tx_nu_certificado,co_id_evento","'".$cod_ponente."',1,1,1,'xxxx',".$co_id_evento.""),'ev_persona_evento');


					
					for($i=0;$i<$tam_arreglo*6;$i=$i+6)
					{

					$cod_participante=$ARREGLO_PARTICIPANTES[$i];
					$cedula_participante=$ARREGLO_PARTICIPANTES[$i+1];
					$nombre_participante=$ARREGLO_PARTICIPANTES[$i+2];

					$culmino_participante=$ARREGLO_PARTICIPANTES[$i+3];
						if($culmino_participante=='S' || $culmino_participante=='s'){
						$culmino="1";}
						else{
						$culmino="0";}

					$certificado_participante=$ARREGLO_PARTICIPANTES[$i+4];
						if($certificado_participante=='S' || $culmino_participante=='s'){
						$certificado="1";}
						else{
						$certificado="0";}

					$n_certificado_participante=$ARREGLO_PARTICIPANTES[$i+5];

					$objConexion->ingresar(array("CodPersona,bo_culmino_evento,bo_recibio_certificado, bo_ponente,tx_nu_certificado,co_id_evento","'".$cod_participante."','".$culmino."','".$certificado."',0,'".$n_certificado_participante."',".$co_id_evento.""),'ev_persona_evento');

				/*	$objConexion->modificar(array(
						"CodPersona='".$cod_participante."',
						bo_culmino_evento='".$culmino."',
						bo_recibio_certificado='".$certificado."',
						bo_ponente=0,
						tx_nu_certificado=".$n_certificado_participante.",
						co_id_evento=".$co_id_evento."","co_id_evento=".$co_id_evento."and bo_ponente=0" ),'ev_persona_evento');*/


					}
					}
					

					$resp=1;
				} 

				else
				{
					$resp=0;
				}

		break;

		case 'EventosEliminar':

		if ($objConexion->modificar(array(
				"eliminado=true","co_id_evento=".$co_id_evento),'ev_evento_capacitacion') == true)
				{

					$objConexion->modificar(array(
					"eliminado=true","co_id_evento=".$co_id_evento),'ev_persona_evento');
			
					$resp=1;
				} 
				
				else
				{
					$resp=0;
				}

		break;

            default:
		$resp = "Error acciÃ³n no encontrada";
	}

$datos=json_encode($resp);
echo $datos;
?>
        
